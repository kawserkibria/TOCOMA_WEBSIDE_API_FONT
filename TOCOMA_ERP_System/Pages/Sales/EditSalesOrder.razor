@page "/EditSalesOrder/{salesOrderNo}"
@layout CustomLayout
@inject HttpClient Http
@inject IToastService toastService
@inject IJSRuntime JSRuntime
@using Blazored.Typeahead
@inject Microsoft.JSInterop.IJSRuntime JsRuntime
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage
@inject NavigationManager UriHelper
@*<style>


        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #888;
        }

        tr td {
            text-align: center;
        }

        tr th {
            text-align: center;
        }

        tr td input {
            width: 100%;
        }
    </style>*@

<div class="container">
    <div class="card">
        <div class="card-header">Sales Order</div>
        <EditForm Model="@salesOrder" OnValidSubmit="@SaveSalesOrder">

            <table>
                <thead>
                    <tr>
                        <td>Sales Order No.</td>
                        <td>PO/WO Number</td>
                        <td>WO Date</td>
                        <td>Order Reveived by</td>
                        <td>Customer <a href="#" data-toggle="modal" data-target=".bd-example-modal-lg-customer" style="font-size:13px;text-decoration:none;float:right"><span class="oi oi-pencil"></span></a></td>
                        <td>Contact Person</td>
                        <td>Delivery Date</td>
                    </tr>
                    <tr>
                        @*disabled="@REQ_IS_DISABLE"*@
                        <td><InputText @bind-Value="@salesOrderNo"></InputText></td>
                        <td><InputText @bind-Value="@salesOrder.PO_WO_NUMBER"></InputText></td>
                        <td><input type="text" id="datepicker_planstart" style="height:28px" autocomplete="off" @bind-value="@workOrderDate" placeholder="dd/mm/yy" /></td>
                        <td>
                            <InputSelect @bind-Value="@salesOrder.ORDER_RECEIVED_BY" style="height:28px">
                                <option value="">--Select Employee--</option>
                                @foreach (var employee in employeeList)
                                {
                                    <option value="@employee.EMPLOYEE_NAME">@employee.EMPLOYEE_NAME</option>
                                }
                            </InputSelect>
                        </td>
                        <td>
                            <select @onchange="Customer_Clicked" value="@salesOrder.CUSTOMER_ID" class="form-control">
                                <option value="">--Select Customer--</option>
                                @foreach (var customer in customerList)
                                {
                                    <option value="@customer.CUSTOMER_ID">@customer.CUSTOMER_NAME</option>
                                }
                            </select>
                        </td>
                        <td><InputText @bind-Value="@customer.CONTACT_PERSON_NAME" class="form-control"></InputText></td>
                        <td><input type="text" id="datepicker_actualstart" style="height:28px" autocomplete="off" @bind-value="@deliveryDate" placeholder="dd/mm/yy" /></td>
                    </tr>
                    <tr>
                        <th>Assign To</th>
                    </tr>
                    <tr>
                        <td>
                            <InputSelect @bind-Value="@salesOrder.ASSIGN_TO" style="height:28px">
                                <option value="">--Select Employee--</option>
                                @foreach (var employee in employeeList)
                                {
                                    <option value="@employee.EMPLOYEE_NAME">@employee.EMPLOYEE_NAME</option>
                                }
                            </InputSelect>
                        </td>
                    </tr>
                </thead>
            </table>
            <br />
        </EditForm>
        <div style="margin-bottom:100px">
            <table class="table">
                <tr>
                    <th style="width:20%">Item</th>
                    <th style="width:10%">Pack Size</th>
                    <th style="width:10%">Unit</th>
                    <th style="width:10%">Number of<br />Pack</th>
                    <th style="width:10%">Quantity</th>
                    <th style="width:10%">Rate</th>
                    <th style="width:10%">AIT</th>
                    <th style="width:10%">VAT</th>
                    <th style="width:10%">Amount</th>
                    <th style="width:10%"></th>
                </tr>
                <tr>



                    <td>
                        <input type="text" list="txtSearch" @onchange="ItemSelected" class="form-control" />
                        <datalist id="txtSearch">

                            @foreach (var product in productList)
                            {
                                <option>@product.ITEM_NAME</option>
                            }
                        </datalist>

                    </td>
                    <td><input type="text" @bind-value="@item.PACK_SIZE" class="form-control" /></td>
                    <td>
                        <select @bind="@item.UNIT_ID" style="height:28px" class="form-control">
                            <option value="">Unit</option>
                            @foreach (var unit in unitList)
                            {
                                <option value="@unit.UNIT_ID">@unit.UNIT_NAME</option>
                            }
                        </select>
                    </td>
                    <td><input type="text" @bind-value="@noOfPack" class="form-control" /></td>
                    <td><input type="text" @bind-value="@q" id="quantity" class="form-control" /></td>
                    <td><input type="text" @oninput="@UnitPriceCLicked"  @bind-value="@unitPrice" class="form-control" /></td>
                    <td><input type="text" @bind-value="@ait" id="quantity" class="form-control" /></td>
                    <td><input type="text" @bind-value="@vat" class="form-control" /></td>
                    <td></td>
                    <td><button class="btn btn-primary btn-sm" @onclick=@(() => AddItem())>Add</button></td>




                </tr>
                <tr>
                    <th>
                        <a href="#" data-toggle="modal" data-target=".bd-example-modal-lg" style="font-size:13px;text-decoration:none">Add Item Description &nbsp;<span class="oi oi-pencil"></span></a>
                    </th>
                </tr>
                <tbody>
                    @foreach (var salesItem in salesItemList)
                    {
                        <tr>
                            <td>
                                @salesItem.ITEM_NAME<br />
                                @((MarkupString)@salesItem.ITEM_DESCRIPTION)
                            </td>
                            <td>@salesItem.PACK_SIZE</td>
                            <td>@salesItem.UOM</td>
                            <td>@salesItem.NUMBER_OF_PACK</td>
                            <td>@salesItem.ORDER_QUANTITY</td>
                            <td>@salesItem.UNIT_PRICE</td>
                            <td>@salesItem.AIT</td>
                            <td>@salesItem.VAT</td>
                            <td>@salesItem.TOTAL_PRICE</td>
                            <td><a @onclick=@(() => EditItem(salesItem.ITEM_NAME))><span class="oi oi-pencil"></span></a>&nbsp; &nbsp;<a @onclick=@(() => DeleteItem(salesItem.ITEM_NAME))><span class="oi oi-delete"></span></a></td>
                        </tr>
                    }
                </tbody>
            </table>




            <br />

            <table width="55%" style="margin-bottom:100px">
                @*<tr>
                        <td style="width:27%">Sub Total</td>
                        <td style="width:7%">@requisitionTotal</td>
                    </tr>
                    <tr>
                        <td style="width:27%">LC Amount</td>
                        <td style="width:7%"><input type="text" @oninput="LC_Amount_Clicked" /></td>
                    </tr>
                    <tr>
                        <td style="width:27%">LC Commission</td>
                        <td style="width:7%"><input type="text" @oninput="LC_Commission_Clicked" /></td>
                    </tr>
                    <tr>
                        <td style="width:27%">Insurance</td>
                        <td style="width:7%"><input type="text" @oninput="Insurance_Clicked" /></td>
                    </tr>*@
                <tr>
                    <td>Total Amount(BDT) </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>@Total</td>

                </tr>
                <tr>
                    <td>Discount </td>
                    <td>%</td>
                    <td><input type="text" @oninput="discount_amount_In_Parcent_Clicked" /></td>
                    <td>Tk</td>
                    <td><input type="text" @oninput="discount_amount_In_TK_Clicked" /></td>
                </tr>
                <tr>
                    <td>Net Amount </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>@netAmount</td>
                </tr>
                <tr>
                    <td>Advance Amount </td>
                    <td>%</td>
                    <td><input type="text" @oninput="advance_amount_In_Parcent_Clicked" /></td>
                    <td>Tk</td>
                    <td><input type="text" @oninput="advance_amount_In_TK_Clicked" /></td>
                </tr>
                <tr>
                    <td>Total Net Amount </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>@totalNetAmount</td>
                </tr>
                <tr>
                    <td style="width:60%">Delivery Charge/Others Charge</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><input type="text" @oninput="delivery_And_Others_Clicked" /></td>
                </tr>
                <tr>
                    <td>Grand Total(BDT)</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>@GrandTotal</td>
                </tr>
                <tr>
                    <td colspan="5" style="width:27%;text-align:left">In Words(BDT)  : @Inwords</td>
                </tr>
            </table>

            <br />

            <div class="card">
                <div class="card-header">Terms &nbsp;&nbsp; <a href="#" data-toggle="modal" data-target=".bd-example-modal-xl-alltermsconditions">All</a> &nbsp; <a href="#" data-toggle="modal" data-target=".bd-example-modal-lg-termsconditions"><span class="oi oi-pencil"></span></a></div>

            </div>
            <div style="border: 1px solid #888">
                @foreach (var item in selectedtermsConditionList)
                {
                    <input style="margin-top:5px;margin-left:5px;width:20px" type="checkbox" @onchange="eventArgs => { OtherTermsClicked(Convert.ToString(item.SALES_TERMS_CONDITION_ID), eventArgs.Value); }" /> <label>@item.TERMS_AND_CONDITIONS</label><br />
                }

            </div>

            <br />

            @*Terms & Condition &nbsp; <a href="#" data-toggle="modal" data-target=".bd-example-modal-lg-termsconditions"><span class="oi oi-pencil"></span></a>
                <div style="border: 1px solid #888">
                    @foreach (var item in termsConditionList)
                    {
                        <input style="margin-top:5px;margin-left:5px;width:20px" type="checkbox" @onchange="eventArgs => { OtherTermsClicked(Convert.ToString(item.PURCHASE_TERMS_CONDITION_ID), eventArgs.Value); }" /> <label>@item.TERMS_AND_CONDITIONS</label><br />
                    }

                </div>*@
            <br />
            <button type="submit" @onclick="SaveSalesOrder" class="btn btn-info" style="width:150px">Save</button>
            <button type="button" @onclick="Cancel" class="btn btn-danger" style="width:100px">Cancel</button>
        </div>
    </div>
</div>



@*//--------------Modal Item Description-----*@
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="col-md-12">
        </div>
        <div class="modal-content">
            <div class="modal-header">

                <div class="form-outline">
                    <h4 class="p-2"><img src="images/fountain-pen.png" alt="" width="50" height="50" class="mr-3"><span class="text-uppercase"> ITEM DESCRIPTION</span>  </h4>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <BlazoredTextEditor @ref="@itemDescription">
                    <ToolbarContent>
                        <select class="ql-header">
                            <option selected=""></option>
                            <option value="1"></option>
                            <option value="2"></option>
                            <option value="3"></option>
                            <option value="4"></option>
                            <option value="5"></option>
                        </select>
                        <span class="ql-formats">
                            <button class="ql-bold"></button>
                            <button class="ql-italic"></button>
                            <button class="ql-underline"></button>
                            <button class="ql-strike"></button>
                        </span>
                        <span class="ql-formats">
                            <select class="ql-color"></select>
                            <select class="ql-background"></select>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-list" value="ordered"></button>
                            <button class="ql-list" value="bullet"></button>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-link"></button>
                        </span>
                    </ToolbarContent>
                    <EditorContent>
                        @((MarkupString)@salesItem.ITEM_DESCRIPTION)

                    </EditorContent>
                </BlazoredTextEditor>
            </div>

            <div class="modal-footer">
                @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Send message</button>*@
                <div>
                    <button class="btn btn-info" data-dismiss="modal" style="border:none;width:120px;float:right;margin-left:10px" @onclick=@(() => AddItem())>Add</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>

        </div>
    </div>
</div>


@*//--------------New Customer Entry-----*@
<div class="modal fade bd-example-modal-lg-customer" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="col-md-12">
        </div>
        <div class="modal-content">
            <div class="modal-header">

                <div class="form-outline">
                    <h4 class="p-2"><img src="images/fountain-pen.png" alt="" width="50" height="50" class="mr-3"><span class="text-uppercase"> ADD CUSTOMER</span>  </h4>
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <EditForm Model="@customer">
                    <table width="100%">
                        <thead>
                            <tr>
                                <th style="width:150px">Customer Code</th>
                                <th style="width:400px">Customer Name</th>
                                <th colspan="3">Corporate Address</th>
                            </tr>
                            <tr>
                                <td><InputText @bind-Value="@customer.CUSTOMER_CODE" class="form-control"></InputText></td>
                                <td><InputText @bind-Value="@customer.CUSTOMER_NAME" class="form-control"></InputText></td>
                                <td colspan="3"><InputTextArea @bind-Value="@customer.CORPORATE_ADDRESS" class="form-control"></InputTextArea></td>
                            </tr>
                            <tr>
                                <th>Customer Type</th>
                                <th>Contact Person Name</th>
                                <th>Designation</th>
                                <th>Phone</th>
                                <th>Email</th>
                            </tr>
                            <tr>
                                <td>
                                    <InputSelect @bind-Value="@customer.CUSTOMER_TYPE_ID" class="form-control">
                                        <option value="">--Select Type--</option>
                                        @foreach (var type in customerType)
                                        {
                                            <option value="@type.CUSTOMER_TYPE_ID">@type.CUSTOMER_TYPE</option>
                                        }
                                    </InputSelect>
                                </td>
                                <td><InputText @bind-Value="@customer.CONTACT_PERSON_NAME" class="form-control"></InputText></td>
                                <td><InputText @bind-Value="@customer.CONTACT_PERSON_DESIGNATION" class="form-control"></InputText></td>
                                <td><InputText @bind-Value="@customer.CONTACT_PERSON_PHONE" class="form-control"></InputText></td>
                                <td><InputText @bind-Value="@customer.CONTACT_PERSON_EMAIL" class="form-control"></InputText></td>
                            </tr>
                        </thead>
                    </table>
                </EditForm>

            </div>

            <div class="modal-footer">
                @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Send message</button>*@
                <div>
                    <button class="btn btn-info" data-dismiss="modal" style="border:none;width:120px;float:right;margin-left:10px" @onclick=@(() => AddCustomer())>Add</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>

        </div>
    </div>
</div>

@*-------------Terms & Conditions Modal-----------*@
<div class="modal fade bd-example-modal-lg-termsconditions" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <EditForm Model="@termsconditions">
                <div class="modal-header">
                    <h4 class="p-2"><img src="images/fountain-pen.png" alt="" width="50" height="50" class="mr-3"><span class="text-uppercase">NEW TERMS & CONDITIONS</span>  </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="dashboard-details">

                        <div class="newRequsitionForm-content">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-lg-7">
                                        <div class="row mt-1">
                                            <div class="col-md-6"><label>INSTRUCTION:</label></div>
                                            <div class="col-md-6"><InputTextArea @bind-Value="@termsconditions.TERMS_AND_CONDITIONS" style="width:400px" cols="30" rows="3"></InputTextArea></div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div>
                        <button type="submit" style="width:100px;margin-right:40px" class="btn btn-info" data-dismiss="modal" @onclick=@(() => SaveTermsConditions())>Save</button>
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@*-------------ALL Terms & Conditions Modal-----------*@
<div class="modal fade bd-example-modal-xl-alltermsconditions" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="p-2"><span class="text-uppercase"> TERMS & CONDITIONS</span>  </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="col-md-1 flax">
                <a style="color:Highlight;width:20px" @onclick=@(() => EditTermsConditionItem())><span class="oi oi-pencil"></span></a>&nbsp;
                <a><span class="oi oi-trash" style="color:red;width:20px" @onclick=@(() => DeleteTermsCondition())></span></a>
            </div>




            <div class="modal-body">
                @*<InputTextArea @bind-Value="@termsconditions.TERMS_AND_CONDITIONS" style="width:400px" cols="30" rows="3"></InputTextArea>&nbsp;*@
                @*<a href="#" data-toggle="modal" data-target=".bd-example-modal-lg-expecteddate"><span class="oi oi-pencil"></span></a>&nbsp;
                    <a @onclick=@(() => DeleteItem(salesItem.ITEM_NAME))><span class="oi oi-delete"></span></a>*@
                @if (editfieldsetareastatus == 1)
                {
                    <fieldset style="border: 1px solid lightgray">
                        <legend>Edit Terms & Condition</legend>
                        <textarea @bind="@termsconditions.TERMS_AND_CONDITIONS"></textarea>
                        <button class="btn btn-success" style="width:90px;float:right;margin-right:12px;margin-bottom:20px" @onclick="EditTermsCondition">Edit</button>
                    </fieldset>


                    <br />
                }

                <input type="search" placeholder="search.." @oninput="SearchCondition" />
                <br />
                <br />
                @foreach (var item in termsConditionList)
                {
                    <input style="margin-top:5px;margin-left:5px;width:20px" type="checkbox" @onchange="eventArgs => { OtherTermsClicked(Convert.ToString(item.SALES_TERMS_CONDITION_ID), eventArgs.Value); }" /> <label>@item.TERMS_AND_CONDITIONS</label><br />
                }
            </div>
            <div class="modal-footer">
                <div>
                    <button style="width:100px" data-dismiss="modal">Close</button>
                    <button type="submit" style="width:100px;margin-right:40px" class="btn btn-info" @onclick="GetSelectedTerms">Add</button>
                </div>
            </div>

        </div>
    </div>
</div>




@code {
    List<CustomerModel> customerList = new List<CustomerModel>();
    SalesOrderModel salesOrder = new SalesOrderModel();
    CustomerModel customer = new CustomerModel();
    List<EmployeeModel> employeeList = new List<EmployeeModel>();
    SalesOrderItemDetailsModel salesItemDetails = new SalesOrderItemDetailsModel();
    List<SalesOrderItemDetailsModel> salesItemDetailsList = new List<SalesOrderItemDetailsModel>();
    ItemEntity item = new ItemEntity();
    List<UnitModel> unitList = new List<UnitModel>();
    List<PurchaseTermsConditionsModel> termsConditionList = new List<PurchaseTermsConditionsModel>();
    PurchaseTermsConditionsModel termsconditions = new PurchaseTermsConditionsModel();
    string workOrderDate = "";
    string deliveryDate = "";
    string selectedunit;
    private string value { get; set; }
    string noOfPack;
    string terms_And_Conditions_No;
    decimal discount_amount_In_Parcent;
    decimal discount_amount_In_Taka;
    decimal advance_amount_In_Parcent;
    decimal advance_amount_In_Taka;
    decimal netAmount = 0;
    decimal totalNetAmount = 0;
    decimal deliveryAndOthers = 0;
    [Parameter]
    public string salesOrderNo { get; set; }
    string customerName;
    int editfieldsetareastatus = 0;

    //---------------------

    private List<PurchaseRequisitionEntity> Customers { get; set; }
    PurchaseRequisitionEntity purchaseRequisition = new PurchaseRequisitionEntity();
    SalesQuotationModel salesQuotation = new SalesQuotationModel();
    SalesItemDetailsModel salesItem = new SalesItemDetailsModel();
    List<SalesItemDetailsModel> salesItemList = new List<SalesItemDetailsModel>();
    List<SalesItemDetailsModel> itemList = new List<SalesItemDetailsModel>();
    List<PurchaseRequisitionDetailsEntity> requisitionDetailsEntities = new List<PurchaseRequisitionDetailsEntity>();
    PurchaseRequisitionDetailsEntity details = new PurchaseRequisitionDetailsEntity();
    PurchaseRequisitionOthersModel reqOthers = new PurchaseRequisitionOthersModel();
    List<PurchaseRequisitionOthersModel> reqOthersList = new List<PurchaseRequisitionOthersModel>();
    List<DepartmentEntity> departmentList = new List<DepartmentEntity>();
    List<ItemEntity> productList = new List<ItemEntity>();
    private ItemEntity SelectedArticle;
    List<OrderItemEntity> requestItemList = new List<OrderItemEntity>();
    List<OthersRequisitionItemsModel> othersItemList = new List<OthersRequisitionItemsModel>();
    OthersRequisitionItemsModel othersItem = new OthersRequisitionItemsModel();
    List<CustomerTypeModel> customerType = new List<CustomerTypeModel>();
    List<PurchaseTermsConditionsModel> AlltermsConditionList = new List<PurchaseTermsConditionsModel>();
    List<PurchaseTermsConditionsModel> selectedtermsConditionList = new List<PurchaseTermsConditionsModel>();
    TAX_CLASS tax = new TAX_CLASS();
    string searchitem = "";
    OrderItemEntity orderitem;
    OrderItemEntity order_itm = null;
    BlazoredTextEditor itemDescription;
    string q = "";
    decimal unitPrice = 0;
    string itemname;
    double requisitionTotal = 0;
    decimal salesSubTotal = 0;

    double othersSubTotal = 0;
    //DateTime request_date = System.DateTime.Now;
    string quotation_date;
    string validupto_date;
    int tablerow;
    string selected_department;
    int selected_department_Id;
    string cheque_Date;
    bool checked_cheque;
    decimal GrandTotal;
    decimal Total = 0;
    decimal LC_AMOUNT;
    decimal LC_COMMISSION;
    decimal INSURANCE;
    string Inwords;
    string othersItemName;
    string othersitemQuantity;
    string OthersitemRate;
    string reqNo;
    protected bool REQ_IS_DISABLE { get; set; }

    string companyShortForm = "";
    int termsconditionId;
    string termsId;
    decimal ait;
    decimal vat;
    decimal ait_in_Parcent = 0;
    decimal VAT_with_Price_and_AIT = 0;
    decimal totalUnitPrice = (decimal)0.00;



    protected override async Task OnInitializedAsync()
    {
        tablerow = 1;
        //itemname = itemname + "_" + tablerow;
        await DepartmentList();
        await GetItemList();
        await GetCustomer();
        await GetCustomerType();
        await GetReqNo();
        await GetEmployee();
        unitList = await Http.GetJsonAsync<List<UnitModel>>(Utility.BaseUrl + "api/Setup/GetUnitList");
        termsConditionList = await Http.GetJsonAsync<List<PurchaseTermsConditionsModel>>(Utility.BaseUrl + "api/Setup/GetSalesTermsConditions");
        AlltermsConditionList = termsConditionList;
        salesOrder = await Http.GetJsonAsync<SalesOrderModel>(Utility.BaseUrl + "api/Sales/GetSalesInfoBySalesOrderNo/" + salesOrderNo);
        salesItemList = await Http.GetJsonAsync<List<SalesItemDetailsModel>>(Utility.BaseUrl + "api/Sales/GetSalesItemByPONo/" + salesOrderNo);
        workOrderDate = salesOrder.PO_WO_DATE.Day + "/" + salesOrder.PO_WO_DATE.Month + "/" + salesOrder.PO_WO_DATE.Year;
        deliveryDate = salesOrder.DELIVERY_DATE.Day + "/" + salesOrder.DELIVERY_DATE.Month + "/" + salesOrder.DELIVERY_DATE.Year;
        customerName = salesOrder.CUSTOMER_NAME;
        if (customerList != null)
        {
            customer.CONTACT_PERSON_NAME = customerList.Find(x => x.CUSTOMER_ID == salesOrder.CUSTOMER_ID).CONTACT_PERSON_NAME;
        }
        termsId = salesOrder.TERMS_AND_CONDITION;
        if (termsId != null && termsId != "") { selectedtermsConditionList = await Http.GetJsonAsync<List<PurchaseTermsConditionsModel>>(Utility.BaseUrl + "api/Sales/GetSalesTermsAndConditionsByIds/" + termsId); }
        tax=await Http.GetJsonAsync<TAX_CLASS>(Utility.BaseUrl + "api/Setup/GetTaxInfo");
        ait = tax.AIT;
        vat = tax.VAT;


    }
    public async void EditTermsConditionItem()
    {
        if (termsconditionId != 0)
        {
            editfieldsetareastatus = 1;
            termsconditions.TERMS_AND_CONDITIONS = termsConditionList.Find(x => x.SALES_TERMS_CONDITION_ID == termsconditionId).TERMS_AND_CONDITIONS;
        }
    }
    private async Task DeleteTermsCondition()
    {
        if (termsconditionId != 0)
        {
            if (!await JSRuntime.InvokeAsync<bool>("confirm", $"Are you sure you want to delete ?"))
                return;

            await Http.DeleteAsync(Utility.BaseUrl + "api/Setup/DeleteTermsConditions/" + termsconditionId);
            await GetAllTermsCondition();
        }


    }

    private async Task GetItemList()
    {
        productList = await Http.GetJsonAsync<List<ItemEntity>>(Utility.BaseUrl + "api/Product");
    }
    private async Task GetCustomer()
    {
        customerList = await Http.GetJsonAsync<List<CustomerModel>>(Utility.BaseUrl + "api/Customer");
    }
    private async Task GetCustomerType()
    {
        customerType = await Http.GetJsonAsync<List<CustomerTypeModel>>(Utility.BaseUrl + "api/Customer/GetCustomerType");
    }
    private async Task GetEmployee()
    {
        employeeList = await Http.GetJsonAsync<List<EmployeeModel>>(Utility.BaseUrl + "api/Employee");
    }
    public async Task GetReqNo()
    {
        //var reqNo = await Http.GetJsonAsync<RequisitionNo>(Utility.BaseUrl + "api/Purchase/GetReqNo");
        reqNo = await Http.GetStringAsync(Utility.BaseUrl + "api/Purchase/GetReqNo");
        purchaseRequisition.REQUISITION_NO = Convert.ToString(reqNo);

        REQ_IS_DISABLE = true;
        StateHasChanged();
    }

    private async Task<IEnumerable<ItemEntity>> SearchArticles(string searchText)
    {
        searchitem = searchText;
        return await Task.FromResult(productList.Where(x => x.ITEM_NAME.ToLower().Contains(searchText.ToLower())));
    }
    private async Task DepartmentList()
    {
        departmentList = await Http.GetJsonAsync<List<DepartmentEntity>>(Utility.BaseUrl + "api/Department");

    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await JSRuntime.InvokeVoidAsync("JsInteropDatepicker");
    }
    private void Add()
    {
        tablerow = tablerow + 1;
        itemname = itemname + "_" + tablerow;
        StateHasChanged();
    }
    private async Task UnitPriceCLicked(ChangeEventArgs change)
    {
        if (change.Value != "") { unitPrice = Convert.ToDecimal(change.Value); }
        else { unitPrice = 0; }

        Calculation();
    }

    private void Calculation()
    {
        decimal AIT = (unitPrice * ait) / 100;
        ait_in_Parcent = Convert.ToDecimal(String.Format("{0:0.00}", AIT));
        decimal unitPriceAndAit = unitPrice + ait_in_Parcent;
        decimal p = (unitPriceAndAit * Convert.ToDecimal(vat)) / 100;
        VAT_with_Price_and_AIT = Convert.ToDecimal(String.Format("{0:0.00}", p));
        decimal tUnitPrice = unitPrice + ait_in_Parcent + p;
        totalUnitPrice = Convert.ToDecimal(String.Format("{0:0.00}", tUnitPrice));
        StateHasChanged();
    }
    protected async Task AddItem()
    {
        if (IsValidation_Table_Item() != true)
        {
            bool alreadyExists = productList.Any(x => x.ITEM_NAME.ToString().Trim() == itemname.ToString().Trim());
            order_itm = new OrderItemEntity();
            salesItem = new SalesItemDetailsModel();
            salesItem.ITEM_ID = productList.Find(x => x.ITEM_NAME == itemname).ITEM_ID;
            salesItem.ITEM_NAME = itemname;
            salesItem.PACK_SIZE = item.PACK_SIZE;
            salesItem.UOM = item.UOM;
            salesItem.NUMBER_OF_PACK = noOfPack;
            salesItem.ORDER_QUANTITY = Convert.ToDouble(q);
            salesItem.UNIT_PRICE = Convert.ToDecimal(unitPrice);
            salesItem.UOM = productList.Find(x => x.ITEM_NAME == itemname).UOM;
            salesItem.PACK_SIZE = productList.Find(x => x.ITEM_NAME == itemname).PACK_SIZE;
            if (ait != null && ait !=0)
            { salesItem.AIT = Convert.ToDecimal(ait); }
            if (vat != null && vat !=0)
            { salesItem.VAT = Convert.ToDecimal(vat); }
            salesItem.ITEM_DESCRIPTION = await this.itemDescription.GetHTML();

            //if (alreadyExists == true)
            //{
            //    order_itm.ITEM_ID = productList.FirstOrDefault(x => x.ITEM_NAME.ToString().Trim() == itemname.ToString().Trim()).ITEM_ID;
            //    order_itm.PACK_SIZE = productList.FirstOrDefault(x => x.ITEM_NAME.ToString().Trim() == itemname.ToString().Trim()).PACK_SIZE;
            //    order_itm.UOM = productList.FirstOrDefault(x => x.ITEM_NAME.ToString().Trim() == itemname.ToString().Trim()).UOM;
            //}
            //else
            //{
            //    order_itm.ITEM_ID = await Http.GetJsonAsync<int>(Utility.BaseUrl + "api/Purchase/GetItemId/" + itemname);
            //}

            salesItem.TOTAL_PRICE = totalUnitPrice;//Convert.ToDecimal(salesItem.ORDER_QUANTITY) * Convert.ToDecimal(salesItem.UNIT_PRICE);
            salesSubTotal += salesItem.TOTAL_PRICE;
            salesItemList.Add(salesItem);

            //q = "";
            //r = "";
            //itemname = "";
            TotalCalculation();
            salesItem = new SalesItemDetailsModel();
            itemname = "";
            q = "";
            unitPrice =0;
            ait = tax.AIT;
            vat = tax.VAT;

        }


    }
    public List<string> checkedOtherTermsIds { get; set; } = new List<string>();
    void OtherTermsClicked(string termsConditionids, object checkedValue)
    {
        if ((bool)checkedValue)
        {
            if (!checkedOtherTermsIds.Contains(termsConditionids))
            {
                checkedOtherTermsIds.Add(termsConditionids);
            }
        }
        else
        {
            if (checkedOtherTermsIds.Contains(termsConditionids))
            {
                checkedOtherTermsIds.Remove(termsConditionids);
            }
        }
        terms_And_Conditions_No = String.Join(",", checkedOtherTermsIds);
    }
    public async Task SaveTermsConditions()
    {

        if (IsValidation_TermsConditions() != true)
        {
            try
            {
                var data = await Http.PostJsonAsync<PurchaseTermsConditionsModel>(Utility.BaseUrl + "api/Setup/AddTermsConditions", termsconditions);
                toastService.ShowSuccess("Insert Successfully!!!");
            }
            catch (Exception ex)
            {

            }


        }
        termsConditionList = await Http.GetJsonAsync<List<PurchaseTermsConditionsModel>>(Utility.BaseUrl + "api/Setup/GetTermsConditions");
        termsconditions.TERMS_AND_CONDITIONS = "";
    }
    private bool IsValidation_TermsConditions()
    {
        bool flag = false;
        if (termsconditions.TERMS_AND_CONDITIONS == "" || termsconditions.TERMS_AND_CONDITIONS == string.Empty || termsconditions.TERMS_AND_CONDITIONS == null)
        {
            toastService.ShowWarning("Terms & Condition Field Cannot be empty!");
            flag = true;
        }

        return flag;
    }
    protected async Task AddOthersItem()
    {
        othersItem = new OthersRequisitionItemsModel();
        othersItem.OTHERS_ITEM = othersItemName;
        if (othersitemQuantity != null && othersitemQuantity != "")
        { othersItem.QUANTITY = Convert.ToDouble(othersitemQuantity); }
        else { othersItem.QUANTITY = 0; }

        othersItem.RATE = Convert.ToDouble(OthersitemRate);
        if (othersitemQuantity != null && othersitemQuantity != "" && othersitemQuantity != "0") { othersItem.TOTAL = Convert.ToDouble(othersitemQuantity) * Convert.ToDouble(OthersitemRate); }
        else { othersItem.TOTAL = Convert.ToDouble(OthersitemRate); }

        othersSubTotal += othersItem.TOTAL;
        othersItemList.Add(othersItem);
        othersItemName = "";
        othersitemQuantity = "";
        OthersitemRate = "";
        TotalCalculation();
    }
    public async void DeleteOthersItem(string item)
    {
        var itemToRemove = othersItemList.Single(r => r.OTHERS_ITEM == item);
        othersItemList.Remove(itemToRemove);
        if (othersItemList.Count > 0)
        {
            othersSubTotal = 0;
            foreach (var _oitem in othersItemList)
            {
                othersSubTotal += _oitem.TOTAL;
            }
        }
        else { othersSubTotal = 0; }

        TotalCalculation();
        StateHasChanged();
    }
    //--------------
    public async void DeleteItem(string item)
    {
        var itemToRemove = salesItemList.Single(r => r.ITEM_NAME == item);
        salesItemList.Remove(itemToRemove);
        if (salesItemList.Count > 0)
        {
            salesSubTotal = 0;
            foreach (var _oitem in salesItemList)
            {
                salesSubTotal += _oitem.TOTAL_PRICE;
            }
        }
        else { salesSubTotal = 0; }

        TotalCalculation();
        StateHasChanged();
    }
    public async void EditItem(string item)
    {
        itemname = salesItemList.Single(r => r.ITEM_NAME == item).ITEM_NAME;
        q = Convert.ToString(salesItemList.Single(r => r.ITEM_NAME == item).ORDER_QUANTITY);
        unitPrice = Convert.ToDecimal(salesItemList.Single(r => r.ITEM_NAME == item).UNIT_PRICE);
        ait = Convert.ToDecimal(salesItemList.Single(r => r.ITEM_NAME == item).AIT);
        vat = Convert.ToDecimal(salesItemList.Single(r => r.ITEM_NAME == item).VAT);
        var itemToRemove = salesItemList.Single(r => r.ITEM_NAME == item);
        salesItemList.Remove(itemToRemove);
        if (requestItemList.Count > 0)
        {
            salesSubTotal = 0;
            foreach (var _oitem in requestItemList)
            {
                salesSubTotal += Convert.ToDecimal(_oitem.Total);
            }
        }
        else { salesSubTotal = 0; }
        TotalCalculation();
        StateHasChanged();
    }
    //
    public async void EditOthersItem(string item)
    {
        othersItemName = othersItemList.Single(r => r.OTHERS_ITEM == item).OTHERS_ITEM;
        othersitemQuantity = Convert.ToString(othersItemList.Single(r => r.OTHERS_ITEM == item).QUANTITY);
        OthersitemRate = Convert.ToString(othersItemList.Single(r => r.OTHERS_ITEM == item).RATE);
        var itemToRemove = othersItemList.Single(r => r.OTHERS_ITEM == item);
        othersItemList.Remove(itemToRemove);
        if (othersItemList.Count > 0)
        {
            othersSubTotal = 0;
            foreach (var _oitem in othersItemList)
            {
                othersSubTotal += _oitem.TOTAL;
            }
        }
        else { othersSubTotal = 0; }
        TotalCalculation();
        StateHasChanged();
    }

    //public async Task GetSalesOrderNo()
    //{
    //    string prefix = "";
    //    prefix = companyShortForm;
    //    //string C = salesQuotation.CUSTOMER_NAME;
    //    //var firstChars = C.Split(' ').Select(s => s[0]);
    //    //foreach(var p in firstChars)
    //    //{
    //    //    prefix += p;
    //    //}
    //    salesOrderNo = await Http.GetStringAsync(Utility.BaseUrl + "api/Sales/GetSalesOrderNo");
    //    salesOrder.SALES_ORDER_NO = salesOrderNo;
    //}
    public async Task SaveSalesOrder()
    {

        if (IsValidation() != true)
        {
            try
            {
                string d = workOrderDate.Replace("/", "-");
                salesOrder.PO_WO_DATE = Convert.ToDateTime(d);
                string dd = deliveryDate.Replace("/", "-");
                salesOrder.DELIVERY_DATE = Convert.ToDateTime(dd);
                salesOrder.GRAND_TOTAL = Convert.ToDouble(GrandTotal);
                salesOrder.TERMS_AND_CONDITION = terms_And_Conditions_No;
                salesOrder.REG_BY = await sessionStorage.GetItemAsync<string>("session_employeeLoginId");
                salesOrder.TOTAL_AMOUNT = Total;
                salesOrder.DISCOUNT_IN_PARCHENT = discount_amount_In_Parcent;
                salesOrder.DISCOUNT_IN_TAKA = discount_amount_In_Taka;
                salesOrder.ADVANCE_PAID_IN_PARCHENT = advance_amount_In_Parcent;
                salesOrder.ADVANCE_PAID_IN_TAKA = advance_amount_In_Taka;
                salesOrder.DELIVERY_CHARGE = deliveryAndOthers;

                //await GetSalesOrderNo();
                var data = await Http.PutJsonAsync<SalesOrderModel>(Utility.BaseUrl + "api/Sales/UpdateSalesOrder/", salesOrder);

                //var id = await Http.GetJsonAsync<int>(Utility.BaseUrl + "api/Sales/GetSalesOrderId/" + salesOrder.PO_WO_NUMBER);
                foreach (var item in salesItemList)
                {
                    salesItem = new SalesItemDetailsModel();
                    salesItem.SALES_ID = item.SALES_ID;
                    salesItem.PO_WO_NUMBER = salesOrder.PO_WO_NUMBER;
                    salesItem.SALES_ORDER_NO = salesOrder.SALES_ORDER_NO;
                    salesItem.ITEM_ID = item.ITEM_ID;
                    salesItem.ITEM_DESCRIPTION = item.ITEM_DESCRIPTION;
                    salesItem.ORDER_QUANTITY = item.ORDER_QUANTITY;
                    salesItem.UOM = item.UOM;
                    salesItem.PACK_SIZE = item.PACK_SIZE;
                    salesItem.UNIT_PRICE = item.UNIT_PRICE;
                    salesItem.AIT = item.AIT;
                    salesItem.VAT = item.VAT;
                    salesItem.TOTAL_PRICE = item.TOTAL_PRICE;

                    itemList.Add(salesItem);
                }
                var salesitem_details = await Http.PutJsonAsync<List<SalesItemDetailsModel>>(Utility.BaseUrl + "api/Sales/UpdateSalesOrderDetails", itemList);

                toastService.ShowSuccess("Insert Successfully!!!");
                salesItem = new SalesItemDetailsModel();

            }
            catch (Exception ex)
            {
                toastService.ShowWarning("Not Save" + ex.Message);
            }

        }
    }
    private bool IsValidation_Table_Item()
    {
        bool flag = false;
        if (itemname == "" || itemname == string.Empty || itemname == null)
        {
            toastService.ShowWarning("Please Select Item!");
            flag = true;
        }
        else if (q == "" || q == string.Empty || q == null)
        {
            toastService.ShowWarning("Quantity Field is Empty!");
            flag = true;
        }
        else if (unitPrice ==0 && unitPrice == null)
        {
            toastService.ShowWarning("Unit Price Field is Empty!");
            flag = true;
        }
        return flag;
    }
    //private async void ItemSelected(ChangeEventArgs changeEvent)
    //{
    //    item = await Http.GetJsonAsync<ItemEntity>(Utility.BaseUrl + "api/Product/GetItemByItemName/" + itemname);
    //    selectedunit = item.UNIT_NAME;
    //}

    private async void ItemSelected(Microsoft.AspNetCore.Components.ChangeEventArgs args)
    {
        value = (string)args.Value;
        itemname = value;
        item = await Http.GetJsonAsync<ItemEntity>(Utility.BaseUrl + "api/Product/GetItemByItemName/" + value);
        selectedunit = item.UNIT_NAME;
        StateHasChanged();
    }

    private bool IsValidation()
    {
        bool flag = false;
        if (salesOrder.PO_WO_NUMBER == "" || salesOrder.PO_WO_NUMBER == string.Empty || salesOrder.PO_WO_NUMBER == null)
        {
            toastService.ShowWarning("PO/WO No. cannot be empty!");
            flag = true;
        }


        return flag;
    }
    //private void ClearData()
    //{
    //    purchaseRequisition.REQUISITION_NO = "";
    //    purchaseRequisition.REQUESTED_BY = "";
    //    purchaseRequisition.REQUEST_DATE = System.DateTime.Now;
    //    purchaseRequisition.REQUIRED_DATE = System.DateTime.Now;
    //    purchaseRequisition.REQUEST_FOR = "";
    //    purchaseRequisition.REQUISITION_PURPOSE = "";
    //    requestItemList = null;

    //}
    private async Task Requesst_Receive_Dept_Click(ChangeEventArgs changeEventArgs)
    {

        selected_department_Id = Convert.ToInt32(changeEventArgs.Value);
        selected_department = departmentList.Find(x => x.DEPARTMENT_ID == selected_department_Id).DEPARTMENT_NAME;
        StateHasChanged();
    }
    private async Task LC_Amount_Clicked(ChangeEventArgs lcAmount)
    {
        if (lcAmount.Value.ToString() != "0" && lcAmount.Value.ToString() != null && lcAmount.Value.ToString() != "")
        {
            LC_AMOUNT = Convert.ToDecimal(lcAmount.Value.ToString());
            TotalCalculation();
        }
        else
        {
            LC_AMOUNT = 0;
            TotalCalculation();
        }


    }
    private async Task LC_Commission_Clicked(ChangeEventArgs lcCommission)
    {
        if (lcCommission.Value.ToString() != "0" && lcCommission.Value.ToString() != null && lcCommission.Value.ToString() != "")
        {
            LC_COMMISSION = Convert.ToDecimal(lcCommission.Value.ToString());
            TotalCalculation();
        }
        else
        {
            LC_COMMISSION = 0;
            TotalCalculation();
        }

    }
    private async Task Insurance_Clicked(ChangeEventArgs Insurance)
    {
        if (Insurance.Value.ToString() != "0" && Insurance != null && Insurance.Value.ToString() != "")
        {
            INSURANCE = Convert.ToDecimal(Insurance.Value.ToString());
            TotalCalculation();
        }
        else
        {
            INSURANCE = 0;
            TotalCalculation();
        }

    }

    async void PaymentMode_ChequeClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        {
            checked_cheque = true;
            purchaseRequisition.PAYMENT_MODE = "Cheque";
        }
        else
        {
            checked_cheque = false;
            cheque_Date = "";
            purchaseRequisition.PAYMENT_MODE = "";
        }
        StateHasChanged();
    }
    //PaymentMode_PayorderClicked(
    //PaymentMode_TTClicked( event
    //PaymentMode_InAdvanceClicked
    //PaymentMode_OthersClicked(e
    async void PaymentMode_CashClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        { purchaseRequisition.PAYMENT_MODE = "Cash"; }
        else { purchaseRequisition.PAYMENT_MODE = ""; }

    }
    async void PaymentMode_PayorderClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        { purchaseRequisition.PAYMENT_MODE = "Payorder"; }
        else { purchaseRequisition.PAYMENT_MODE = ""; }
    }
    async void PaymentMode_TTClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        { purchaseRequisition.PAYMENT_MODE = "TT"; }
        else { purchaseRequisition.PAYMENT_MODE = ""; }
    }
    async void PaymentMode_InAdvanceClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        { purchaseRequisition.PAYMENT_MODE = "InAdvance"; }
        else { purchaseRequisition.PAYMENT_MODE = ""; }
    }
    async void PaymentMode_OthersClicked(object checkedValue)
    {
        if ((bool)checkedValue)
        { purchaseRequisition.PAYMENT_MODE = "Others"; }
        else { purchaseRequisition.PAYMENT_MODE = ""; }
    }
    async void Customer_Clicked(ChangeEventArgs eventArgs)
    {
        salesOrder.CUSTOMER_ID = Convert.ToInt32(eventArgs.Value.ToString());
        await GetCustomerData(salesOrder.CUSTOMER_ID);
    }
    private async Task GetCustomerData(int customerId)
    {
        customer = await Http.GetJsonAsync<CustomerModel>(Utility.BaseUrl + "api/Customer/GetCustomerData/" + customerId);


        StateHasChanged();
    }
    private async Task discount_amount_In_Parcent_Clicked(ChangeEventArgs change)
    {
        if (Total != 0 && change.Value != "")
        { discount_amount_In_Parcent = (Total * Convert.ToDecimal(change.Value)) / 100; }
        else { discount_amount_In_Parcent = 0; }
        TotalCalculation();
    }
    private async Task discount_amount_In_TK_Clicked(ChangeEventArgs change)
    {
        if (Total != 0 && change.Value != "") { discount_amount_In_Taka = Convert.ToDecimal(change.Value); }
        else { discount_amount_In_Taka = 0; }
        TotalCalculation();
    }
    private async Task advance_amount_In_Parcent_Clicked(ChangeEventArgs change)
    {
        if (Total != 0 && change.Value != "") { advance_amount_In_Parcent = (Total * Convert.ToDecimal(change.Value)) / 100; }
        else { advance_amount_In_Parcent = 0; }
        TotalCalculation();
    }
    private async Task advance_amount_In_TK_Clicked(ChangeEventArgs change)
    {
        if (Total != 0 && change.Value != "") { advance_amount_In_Taka = Convert.ToDecimal(change.Value); }
        else { advance_amount_In_Taka = 0; }
        TotalCalculation();
    }
    private async Task delivery_And_Others_Clicked(ChangeEventArgs change)
    {
        if (change.Value != "") { deliveryAndOthers = Convert.ToDecimal(change.Value); }
        else { deliveryAndOthers = 0; }
        TotalCalculation();
    }

    private void TotalCalculation()
    {
        //if (requisitionTotal != 0 || requisitionTotal != null)
        //{ GrandTotal = Convert.ToDecimal(requisitionTotal); }
        //if(LC_AMOUNT!=0||LC_AMOUNT!=null)
        //{ GrandTotal= }
        Total = Convert.ToDecimal(salesSubTotal) + LC_AMOUNT + LC_COMMISSION + INSURANCE + Convert.ToDecimal(othersSubTotal);
        netAmount = Total;
        totalNetAmount = Total;
        GrandTotal = Total;
        if (discount_amount_In_Parcent != 0)
        {
            netAmount = Total - discount_amount_In_Parcent;
            totalNetAmount = netAmount;
            GrandTotal = netAmount;
        }
        if (discount_amount_In_Taka != 0)
        {
            netAmount = Total - discount_amount_In_Taka;
            totalNetAmount = netAmount;
            GrandTotal = netAmount;
        }
        if (advance_amount_In_Parcent != 0)
        {
            //decimal sum = advance_amount_In_Parcent + discount_amount_In_Parcent + discount_amount_In_Taka;
            totalNetAmount = Total - (advance_amount_In_Parcent + discount_amount_In_Parcent + discount_amount_In_Taka);
            GrandTotal = totalNetAmount;
        }
        if (advance_amount_In_Taka != 0)
        {
            totalNetAmount = Total - (advance_amount_In_Taka + discount_amount_In_Parcent + discount_amount_In_Taka);
            GrandTotal = totalNetAmount;
        }
        if (deliveryAndOthers != 0)
        {
            GrandTotal = totalNetAmount + deliveryAndOthers;
        }


        //GrandTotal = (Convert.ToDecimal(salesSubTotal) + LC_AMOUNT + LC_COMMISSION + INSURANCE + Convert.ToDecimal(othersSubTotal))- discount_amount_In_Parcent;
        //GrandTotal = (Convert.ToDecimal(salesSubTotal) + LC_AMOUNT + LC_COMMISSION + INSURANCE + Convert.ToDecimal(othersSubTotal)) - discount_amount_In_Taka;
        double inwordValue = Convert.ToDouble(GrandTotal);
        Inwords = NumberToWords.ConvertAmount(inwordValue);
    }
    private Task OnValueChanged(int value)
    {
        // Assign the selected value to the Model
        purchaseRequisition.REQUEST_RECEIVE_DEPARTMENT_ID = Convert.ToInt32(value);
        return Task.CompletedTask;
    }
    private async Task ReceiveDepartmentClicked(ChangeEventArgs changeEvent)
    {
        int changeId = Convert.ToInt32(changeEvent.Value.ToString());
        purchaseRequisition.REQUEST_RECEIVE_DEPARTMENT_ID = changeId;
        string dName = departmentList.Find(x => x.DEPARTMENT_ID == changeId).DEPARTMENT_NAME;
        if (dName == "Accounts & Finance")
        {
            reqNo = reqNo + "AF";
            purchaseRequisition.REQUISITION_NO = reqNo;
        }
    }
    public async Task AddCustomer()
    {

        if (IsCustomerValidation() != true)
        {
            try
            {
                var data = await Http.PostJsonAsync<CustomerModel>(Utility.BaseUrl + "api/Customer", customer);

                toastService.ShowSuccess("Requisition Generate Successfully!!!");
                await GetCustomer();
                customer = new CustomerModel();

            }
            catch (Exception ex)
            {

            }

        }
    }
    private bool IsCustomerValidation()
    {
        bool flag = false;
        if (customer.CUSTOMER_NAME == "" || customer.CUSTOMER_NAME == string.Empty || customer.CUSTOMER_NAME == null)
        {
            toastService.ShowWarning("Customer Name cannot be empty!");
            flag = true;
            flag = true;
        }


        return flag;
    }
    public async Task EditTermsCondition()
    {

        if (IsValidation_TermsConditions() != true)
        {
            try
            {
                termsconditions.SALES_TERMS_CONDITION_ID = termsconditionId;
                var data = await Http.PutJsonAsync<PurchaseTermsConditionsModel>(Utility.BaseUrl + "api/Setup/UpdateSalesTermsConditions", termsconditions);

            }
            catch (Exception ex)
            {

            }


        }
        await GetAllTermsCondition();
        termsconditions.TERMS_AND_CONDITIONS = "";
        editfieldsetareastatus = 0;
    }
    private async Task GetAllTermsCondition()
    {
        termsConditionList = await Http.GetJsonAsync<List<PurchaseTermsConditionsModel>>(Utility.BaseUrl + "api/Setup/GetSalesTermsConditions");
    }
    private async Task SearchCondition(ChangeEventArgs changeEvent)
    {
        string value = changeEvent.Value.ToString();
        if (value != "")
        { termsConditionList = await Http.GetJsonAsync<List<PurchaseTermsConditionsModel>>(Utility.BaseUrl + "api/Setup/GetSalesTermsConditionsBySearch/" + value); }
        else { await GetAllTermsCondition(); }


    }
    private void Cancel()
    {
        UriHelper.NavigateTo("/SalesOrderList");
    }
    private async Task GetSelectedTerms()
    {
        int[] nums = Array.ConvertAll(terms_And_Conditions_No.Split(','), int.Parse);
        PurchaseTermsConditionsModel tcon = new PurchaseTermsConditionsModel();
        foreach (var item in nums)
        {
            tcon = new PurchaseTermsConditionsModel();
            tcon.PURCHASE_TERMS_CONDITION_ID = 0;
            tcon.SALES_TERMS_CONDITION_ID = AlltermsConditionList.Find(x => x.SALES_TERMS_CONDITION_ID == item).SALES_TERMS_CONDITION_ID;
            tcon.SL = 0;
            tcon.TERMS_AND_CONDITIONS = AlltermsConditionList.Find(x => x.SALES_TERMS_CONDITION_ID == item).TERMS_AND_CONDITIONS;


            if (!selectedtermsConditionList.Exists(x => x.SALES_TERMS_CONDITION_ID == item))
            {

                selectedtermsConditionList.Add(tcon);

            }
            else
            {
                selectedtermsConditionList.Where(w => w.SALES_TERMS_CONDITION_ID == item).ToList().ForEach(s => s.SALES_TERMS_CONDITION_ID = tcon.SALES_TERMS_CONDITION_ID);
                selectedtermsConditionList.Where(w => w.SALES_TERMS_CONDITION_ID == item).ToList().ForEach(s => s.TERMS_AND_CONDITIONS = tcon.TERMS_AND_CONDITIONS);
            }

        }

    }
}
